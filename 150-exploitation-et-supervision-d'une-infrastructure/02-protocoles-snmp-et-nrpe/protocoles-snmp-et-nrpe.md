# Protocoles SNMP et NRPE (Supervision avec Centreon)
## üì° SNMP ‚Äì Simple Network Management Protocol

### Pr√©sentation

- Protocole standardis√© par l‚ÄôIETF
- Utilis√© pour **interroger ou recevoir des informations** de la part d‚Äôun √©quipement supervis√© (switch, routeur, serveur‚Ä¶)
- Mode client/serveur :
    - Superviseur : envoie des requ√™tes (port 161 UDP/TCP)
    - Agent supervis√© : peut aussi envoyer des **traps** (alertes) sur le port 162

### Versions

|Version|S√©curit√©|Usage|
|---|---|---|
|SNMPv1|Aucune|Obsol√®te|
|SNMPv2c|Cha√Æne communautaire|Majoritairement utilis√©e (√† s√©curiser)|
|SNMPv3|Authentification + chiffrement|Plus s√©curis√© mais peu impl√©ment√©|

---

## üß† MIB & OID ‚Äì Structure des informations

### MIB (Management Information Base)

- Base hi√©rarchique contenant toutes les variables accessibles via SNMP
- Chaque n≈ìud poss√®de un **OID** (Object Identifier)

### OID

- Suite de chiffres identifiant une variable sp√©cifique
- Ex : `1.3.6.1.2.1.2.2.1.2` = `ifDescr` (description d‚Äôinterface r√©seau)
- OID entreprise : ex. `1.3.6.1.4.1.9` pour Cisco

### Exemple de navigation

```bash
snmpwalk -v2c -c public localhost
snmpwalk -v2c -On -c public localhost     # version num√©rique des OID
```

---

## ‚öôÔ∏è Impl√©mentation SNMP

### Sous Windows

```powershell
Add-WindowsCapability -Online -Name "SNMP.Client~~~~0.0.1.0"
```

- Configuration dans `services.msc > SNMP Service > S√©curit√©`
- ‚ö†Ô∏è SNMPv3 non pris en charge par Windows (Microsoft privil√©gie WMI)

### Sous Linux (Debian)

```bash
apt install snmpd
vim /etc/snmp/snmpd.conf
```

- Red√©marrage n√©cessaire apr√®s modification

### TRAP SNMP

- Envoi automatique d‚Äôune alerte par l‚Äô√©quipement vers le superviseur
- Utilise UDP, pas toujours fiable ‚Üí √† compl√©ter par des **checks actifs**

---

## üß™ Outils Linux utiles

|Commande|Fonction|
|---|---|
|`snmpwalk`|Parcours r√©cursif des OID (exploration)|
|`snmpget`|R√©cup√©ration d‚Äôune valeur sp√©cifique|

---

## üîß NRPE ‚Äì Nagios Remote Plugin Executor

### Pr√©sentation

- Plugin Nagios pour ex√©cuter des scripts √† distance sur un h√¥te supervis√©
- Utilise le port TCP 5666
- Plus adapt√© √† **Windows** ou **serveurs critiques** (chiffrement via SSL)

### Fonctionnement

- Le superviseur envoie une commande via NRPE
- L‚Äô**agent NRPE** ex√©cute localement un **plugin** (script) sur la machine cible
- R√©sultat renvoy√© au superviseur

### Exemple :

- Supervision CPU, RAM, disque, √©tat d‚Äôun service

### D√©ploiement agents

- Windows : installer **NSClient++** ([https://www.nsclient.org](https://www.nsclient.org/))
- Linux : `apt install nagios-nrpe-server`

---

## üîÑ Comparatif SNMP vs NRPE

|Crit√®re|SNMP|NRPE|
|---|---|---|
|S√©curit√©|Faible (sauf v3)|SSL possible|
|Mise en ≈ìuvre|Simple|Plus technique|
|OS support√©s|Tout (y compris √©quipements r√©seau)|Principalement serveurs|
|Fonctionnement|Pull + trap (event)|Commande √† distance|

---

## ‚úÖ √Ä retenir pour les r√©visions

- SNMP est **universel**, NRPE est plus **adapt√© aux serveurs** et contextes sensibles
- SNMPv2c doit √™tre s√©curis√© (filtrage IP, communaut√© forte)
- NRPE permet une supervision **granulaire**, mais n√©cessite plus d‚Äôinstallation c√¥t√© client
- Il est recommand√© d‚Äô**utiliser SNMP et NRPE en compl√©ment**

---

## üìå Bonnes pratiques professionnelles

- Toujours **changer la communaut√© SNMP par d√©faut** (ex : public/private)
- S√©curiser les acc√®s SNMP avec un firewall ou des ACL r√©seau
- Utiliser **SNMPv3** si disponible sur les √©quipements
- Sur Windows, privil√©gier **NSClient++** avec NRPE pour surveiller les services critiques
- Documenter les OID utilis√©s et les √©quipements concern√©s (MIBs sp√©cifiques fabricants)