# Synth√®se ‚Äì Exploitation et supervision d'une infrastructure avec Centreon
## üß© Notions fondamentales

### R√¥le de la supervision

- Garantir la **disponibilit√©**, **performance** et **int√©grit√©** des services
- D√©tecter les incidents le plus t√¥t possible
- Faciliter les actions d‚Äôexploitation (acquittement, red√©marrage, escalade)

### Types de supervision

|Type|Fonction|
|---|---|
|Active|Le superviseur interroge p√©riodiquement|
|Passive|L‚Äôh√¥te superviseur envoie spontan√©ment l‚Äôinformation (ex: SNMP trap)|

---

## üèóÔ∏è Architecture de supervision Centreon

### Composants principaux

|√âl√©ment|Fonction|
|---|---|
|**Centreon Web**|Interface graphique de gestion et consultation|
|**Centreon Engine**|Moteur de supervision (ex√©cution des checks)|
|**Centreon Broker**|Transport, traitement et stockage des r√©sultats|
|**Gorgone**|D√©ploiement de la configuration sur les pollers distants|

### Architecture distribu√©e

- Utilisation de **pollers** pour r√©partir la charge ou superviser des sites distants
- Fonctionnement autonome en cas de coupure r√©seau
- Communication via **SSH** (cl√© entre central et poller)

---

## ‚öôÔ∏è Mise en ≈ìuvre pratique

### √âtapes g√©n√©rales

1. Cr√©ation des **commandes (CHECK_)** : SNMP, NRPE, plugins classiques
2. Cr√©ation des **mod√®les de services (STF_)** avec macros personnalis√©es
3. Cr√©ation des **mod√®les d‚Äôh√¥tes (HTF_, HTC_)**
4. Cr√©ation des **h√¥tes et services** ‚Üí affectation des templates
5. G√©n√©ration et export de la configuration via **Gorgone**
6. V√©rification dans l‚Äôinterface

### Tests et validation

- Test en ligne de commande (`check_http`, `check_rpc`, `check_disk_smb`...)
- Simulation d‚Äôalerte : arr√™t de service, surcharge CPU, changement contenu HTTP

---

## üîê Notifications et actions d‚Äôexploitation

### Actions disponibles

|Action|Effet|
|---|---|
|Acquittement|G√®le les notifications r√©p√©t√©es jusqu‚Äô√† r√©solution|
|Downtime|Supprime la supervision temporairement|
|Check now|For√ßage d‚Äôun check imm√©diat|

### Notifications

- D√©clench√©es √† l‚Äô√©tat **HARD**
- D√©pend de :
    - Commande de notif (ex: `host-notify-by-email`)
    - P√©riode
    - Contacts
    - Type de statut concern√©

---

## üîé Commandes utiles (extraits)

```bash
# V√©rifier un partage Samba
check_disk_smb -H 192.168.1.11 -s admin

# Tester la r√©solution DNS
check_dns -H pcp.local -s 192.168.1.10

# V√©rifier le service RPC NFS
check_rpc -H 192.168.1.12 -C nfs

# Tester un site web sp√©cifique
check_http -H www.pcp.local -p 80 -s 'PCP'
```

---

## ‚ö†Ô∏è Pi√®ges √† √©viter

- Ne pas **tester les sondes en ligne de commande** avant int√©gration
- Oublier de **g√©n√©rer puis exporter** la configuration (rien ne s‚Äôapplique sans cela)
- Utiliser des **valeurs de seuils incoh√©rentes**
- Configurer des notifications sans d√©finir de p√©riode ou de contact

---

## ‚úÖ √Ä retenir pour les r√©visions

- Une configuration dans Centreon repose toujours sur :
    - Une **commande (CHECK_)**
    - Des **mod√®les de service** avec macros (_SERVICEVHOST, _SERVICEPORT...)
    - Des **mod√®les d‚Äôh√¥tes** pour centraliser les options (SNMP, notification)
- Le **poller** permet une supervision distante fiable
- Toute modification n√©cessite **g√©n√©ration + export + v√©rification**

---

## üìå Bonnes pratiques professionnelles

- Structurer avec un **naming convention strict** (CHECK_, STF_, HTF_, S_...)
- Documenter tous les mod√®les et macros dans une fiche centralis√©e
- Tester les plugins en CLI avec `centreon-engine`
- V√©rifier les logs :

```bash
/var/log/centreon-engine/centengine.log
/var/log/centreon-broker/*.log
```

- Pr√©voir des **mod√®les r√©utilisables** pour d√©ployer rapidement sur d'autres clients