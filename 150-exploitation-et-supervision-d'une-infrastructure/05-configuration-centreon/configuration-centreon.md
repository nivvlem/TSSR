# Configuration de Centreon
## 🧩 Bonnes pratiques de configuration

### Commandes

- Nommage structuré : `CHECK_SNMP_CPU`, `CHECK_NRPE_DISK`, etc.
- Toujours utiliser **des arguments variables** avec macros ($ARGn$, $_HOST…$)
- Tester chaque commande en **ligne de commande avec centreon-engine** avant de l’ajouter dans l’interface

### Exemple SNMP CPU

```bash
/usr/lib/centreon/plugins/centreon_windows_snmp.pl \
--plugin=os::windows::snmp::plugin \
--mode=cpu \
--hostname=$HOSTADDRESS$ \
--snmp-community=$_HOSTSNMPCOMMUNITY$ \
--snmp-version=$_HOSTSNMPVERSION$ \
--warning-average=$ARG1$ --critical-average=$ARG2$
```

---

## 🔄 Les macros

### Types de macros

|Type|Exemple|Utilité|
|---|---|---|
|Standard|`$HOSTADDRESS$`|Adresse IP de l’hôte|
|Ressource|`$USER1$`, `$CENTREONPLUGINS$`|Chemins systèmes communs|
|Argument|`$ARG1$`, `$ARG2$`|Paramètres personnalisables par service|
|Personnalisée|`$_HOSTVERSION$`, `$_SERVICEWARNING$`|Macros nommées, plus lisibles|
|À la demande|`$HOSTSTATE:serveurweb1$`|Statut d’un autre hôte/service|

### Avantages des macros personnalisées

- Plus claires et explicites
- Modifiables hôte par hôte ou service par service
- Pas limitées en nombre contrairement à `$ARGn$`

---

## 🛠️ Commandes (Checks)

### Création

Menu : **Configuration > Commands > Checks**

Champs à renseigner :

- Nom (ex: `CHECK_SNMP_CPU`)
- Ligne de commande avec variables ($ARGn$, $_HOST…$)
- Type de commande : `Check` ou `Misc`
- Plugin utilisé : chemin via macro `$CENTREONPLUGINS$`, `$USER1$`

---

## 🧱 Modèles de services

### Objectif

- Créer une base réutilisable de services (CPU, RAM, HTTP…)
- Permet de centraliser les paramètres standards et de les appliquer à plusieurs hôtes

### Types

|Type|Description|
|---|---|
|Configuration (STC_)|Contient les paramètres communs (intervalle, périodicité, seuils…)|
|Fonctionnel (STF_)|Contient la commande (Check), les macros personnalisées…|

### Exemple

- STC_DEFAULT : intervalle 5 min, 3 tentatives, notifications activées
- STF_SNMP_CPU_WINDOWS : héritage de STC_DEFAULT + check CPU avec SNMP

---

## 🧱 Modèles d’hôtes

### Objectif

- Appliquer des services à un groupe de machines automatiquement
- Faciliter la maintenance

### Types

|Type|Description|Exemple|
|---|---|---|
|Configuration (HTC_)|Paramètres SNMP, intervalle, notifications|HTC_DEFAULT|
|Fonctionnel (HTF_)|Regroupement par rôle / type / OS|HTF_WIN_SRVWEB|

### Exemple

- HTC_DEFAULT : SNMP v2c, communauté "sniper", vérification toutes les 5 min
- HTF_LINUX_SERVEUR : service de ping, charge CPU, espace disque

---

## 🔁 Génération de la configuration

### Centreon Web modifie la **base de données**

Les fichiers `.cfg` de Centreon-Engine ne sont générés qu’après action manuelle :

1. **Configuration > Pollers > Generate Configuration** (mode debug recommandé)
2. Vérification de la génération
3. **Déploiement** : remplacement fichiers + redémarrage moteur

---

## 👁️ Interface de supervision

Menu : **Monitoring > Status Details**

- Vue en temps réel des **hôtes** et **services** supervisés
- Statuts (OK, Warning, Critical, Unknown)
- Possibilité d’effectuer des **actions groupées** (Désactiver, Planifier downtime…)
- Vue détaillée d’un hôte ou service : journal, commandes, replanification de check

---

## 📊 Groupes et catégories

### Groupes

- Utilisés pour regrouper les hôtes ou services (Windows, Linux, site, rôle…)
- Affectés manuellement (pas d’héritage via template)

### Catégories

- Servent à regrouper objets par **droit d’accès ou vue métier**
- Utilisées dans les modules payants pour créer des vues dynamiques
- Héritage possible via modèle d’hôte ou service

---

## ✅ À retenir pour les révisions

- L’écriture d’une commande doit être **testée manuellement** et inclure des **macros variables**
- Les **modèles** permettent un déploiement rapide, homogène et maintenable
- Les fichiers `.cfg` ne sont pas générés en temps réel → penser à **générer et déployer**
- Les macros personnalisées permettent des configurations plus explicites et flexibles

---

## 📌 Bonnes pratiques professionnelles

- Respecter une **convention de nommage stricte** pour tous les objets (CHECK_, STC_, STF_, HTC_, HTF_)
- **Centraliser les chemins plugins** dans des macros ressources
- Créer un **template STC par défaut** pour homogénéiser les services
- Générer et tester la config **en mode debug** avant application
- Documenter chaque **commande**, modèle et macro personnalisée