# Les commandes de supervision (Centreon)
## ‚öôÔ∏è Moteur de supervision

- Le moteur **Centreon Engine** ex√©cute des **commandes de v√©rification (checks)** √† intervalles r√©guliers (toutes les 5 min par d√©faut)
- Chaque **h√¥te** (machine) et **service** (CPU, RAM, interface‚Ä¶) dispose d‚Äôune commande associ√©e
- Cette commande, appel√©e **sonde**, retourne un **statut** et parfois des **donn√©es de performance** (graphiques)

---

## üß™ Fonctionnement d‚Äôun check

### √âtapes

1. Le moteur lit la configuration de l‚Äôh√¥te/service √† superviser
2. Il ex√©cute la commande d√©finie
3. La commande interroge la machine ou le service
4. Elle retourne un **code** (statut) + donn√©es (texte ou m√©triques)
5. Le moteur analyse le code retour et applique des actions si n√©cessaire

### Codes retour possibles

#### Pour un h√¥te

|Statut|Code|Signification|
|---|---|---|
|UP|0|L‚Äôh√¥te est joignable|
|DOWN|1|L‚Äôh√¥te est √©teint|
|UNREACHABLE|2|Injoignable car h√¥te parent DOWN|

#### Pour un service

|Statut|Code|Signification|
|---|---|---|
|OK|0|Service op√©rationnel|
|WARNING|1|Risque / attention requise|
|CRITICAL|2|Incident d√©tect√©|
|UNKNOWN|3|Pas d‚Äôinfo ou probl√®me sonde|
|PENDING|4|En attente de donn√©es (statistique)|

---

## üìÇ Emplacement des commandes

### 1. Plugins Nagios

- R√©pertoire : `/usr/lib64/nagios/plugins`
- Commandes historiques (ex : `check_ping`, `check_http`)
- Param√®tres fr√©quents :

```bash
-h       # aide
-w XX    # seuil warning
-c XX    # seuil critique
```

### 2. Centreon Plugins (Perl)

- R√©pertoire : `/usr/lib/centreon/plugins`
- Organis√©s par **domaine** (windows, network, hardware‚Ä¶)
- Utilis√©s via **plugin packs** (certains gratuits, d‚Äôautres payants)

### 3. Plugins SNMP

- Souvent int√©gr√©s aux plugin packs
- Fonctionnent par lecture **OID** depuis un √©quipement
- Exemple : `centreon_windows_snmp.pl`

### 4. Plugins NRPE

- Localis√©s dans : `/usr/lib/nagios/plugins`
- Fichier principal : `check_centreon_nrpe3`
- Utilis√©s pour ex√©cuter des commandes √† distance sur un h√¥te via NRPE

---

## üß∞ Exemples de commandes

### Nagios (local ou distant)

```bash
check_ping -H 8.8.8.8 -w 100,20% -c 300,50%
```

### NRPE (ex√©cut√© depuis Centreon)

```bash
/usr/lib/centreon/plugins/centreon_nrpe3 --plugin-name check_centreon_nrpe3 -H 192.168.0.10 -p 5666 -c check_cpu -a warn=70 crit=90
```

### SNMP

```bash
snmpwalk -v2c -c public 192.168.0.10
snmpget -v2c -c public 192.168.0.10 1.3.6.1.2.1.25.3.3.1.2.196608
```

---

## ‚úÖ √Ä retenir pour les r√©visions

- Chaque **h√¥te/service** dispose d‚Äôune **commande sp√©cifique** (sonde) li√©e √† un **code retour**
- Les commandes peuvent √™tre locales (plugin), √† distance (NRPE), ou via SNMP
- Les statuts d√©terminent l‚Äô√©tat du service (OK, WARNING, CRITICAL‚Ä¶)
- Le bon fonctionnement de la supervision d√©pend d‚Äôune **commande bien test√©e**

---

## üìå Bonnes pratiques professionnelles

- Toujours **tester une commande en ligne de commande** avant int√©gration √† Centreon
- Lire l‚Äôaide `-h` pour comprendre les param√®tres de chaque plugin
- Choisir des seuils **adapt√©s aux usages r√©els** (ne pas se fier aux valeurs par d√©faut)
- Documenter chaque commande utilis√©e pour la supervision d‚Äôun service
- Privil√©gier les **plugins Centreon √† jour** et adapt√©s √† l‚ÄôOS cible (Windows, Linux, r√©seau)